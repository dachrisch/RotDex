{
  "name": "business-logic",
  "version": "1.0.0",
  "description": "Repository and business logic implementation agent",
  "type": "general-purpose",

  "purpose": "Implement repositories and manager classes for business logic",

  "responsibilities": [
    "Create repository classes coordinating data sources",
    "Implement business logic in manager classes",
    "Handle error cases and exceptions",
    "Coordinate between database and API",
    "Implement validation rules",
    "Add to RepositoryModule for Hilt injection",
    "Write unit tests for business logic"
  ],

  "inputs": {
    "required": [
      "Business logic requirements",
      "Data sources (database, API)",
      "Validation rules"
    ],
    "optional": [
      "Caching strategy",
      "Offline support requirements",
      "Complex business rules"
    ]
  },

  "outputs": {
    "deliverables": [
      "Repository classes in data/repository/",
      "Manager classes in data/manager/",
      "RepositoryModule updates",
      "Unit tests for business logic"
    ]
  },

  "workflow": {
    "phase": "3-implementation",
    "parallel_with": ["data-layer", "api-integration"],
    "depends_on": ["Data layer entities and DAOs"],
    "updates": [
      "feature-dev/workflow.json: Update business_logic status",
      "feature-dev/[feature-name].md: Mark business logic tasks complete"
    ]
  },

  "file_locations": {
    "repositories": "app/src/main/java/com/rotdex/data/repository/",
    "managers": "app/src/main/java/com/rotdex/data/manager/",
    "di_module": "app/src/main/java/com/rotdex/di/RepositoryModule.kt",
    "tests": "app/src/test/java/com/rotdex/data/repository/"
  },

  "patterns": {
    "repository": "Coordinates between DAO and API service",
    "manager": "Complex business logic separate from repository",
    "error_handling": "Return Result<T> for operations that can fail",
    "flows": "Expose Flow<T> for observable data",
    "dispatchers": "Use Dispatchers.IO for background operations"
  },

  "prompts": {
    "system_context": "You are implementing business logic for RotDex. Follow repository pattern with separation of concerns. Use Kotlin coroutines and Flow for async operations.",

    "task_template": "Implement business logic for: {feature_name}\n\nRequirements:\n{requirements}\n\nTasks:\n1. Create repository class\n2. Inject dependencies (DAO, API service, other repos)\n3. Implement methods with proper error handling\n4. Use Result<T> for fallible operations\n5. Use Flow<T> for observable data\n6. Add to RepositoryModule\n7. Write unit tests\n\nReference:\n- data/repository/CardRepository.kt\n- data/manager/FusionManager.kt\n- di/RepositoryModule.kt"
  },

  "repository_structure": {
    "constructor_injection": "Use @Inject constructor for Hilt",
    "suspend_functions": "For one-time operations",
    "flow_functions": "For observable data streams",
    "result_types": "Result<T> for operations that can fail",
    "error_propagation": "Catch exceptions and wrap in Result.failure()"
  },

  "validation": {
    "repository_checks": [
      "Proper dependency injection",
      "Error handling for all operations",
      "Appropriate use of coroutines",
      "Flow for reactive data",
      "Result<T> for fallible operations"
    ],
    "manager_checks": [
      "Complex logic separated from repository",
      "Stateless where possible",
      "Well-documented business rules",
      "Validation methods"
    ],
    "di_checks": [
      "Repository provided in RepositoryModule",
      "Dependencies properly injected",
      "Singleton scope where appropriate"
    ]
  },

  "testing_strategy": {
    "unit_tests": [
      "Business logic correctness",
      "Error handling paths",
      "Validation rules",
      "Edge cases"
    ],
    "mocking": "Mock DAOs and API services for testing",
    "test_coroutines": "Use TestCoroutineDispatcher"
  },

  "best_practices": {
    "single_responsibility": "Each repository/manager has one clear purpose",
    "testability": "Design for easy testing with mocks",
    "error_messages": "Clear, actionable error messages",
    "logging": "Log important operations and errors",
    "documentation": "Document complex business rules"
  }
}
